document.addEventListener("DOMContentLoaded",()=>{console.log("=== INITIALISATION PAGE PANIER ===");const t=document.querySelector(".cart-items-list"),e=document.querySelector(".summary-subtotal"),o=document.querySelector(".summary-total-value"),n=document.querySelector(".empty-cart-message"),c=document.querySelector(".cart-summary-section"),a=document.querySelector(".cart-count");function s(){try{const t=localStorage.getItem("cart");console.log("Données brutes du panier:",t);const e=JSON.parse(t||"[]");return console.log("Panier parsé:",e),e}catch(t){return console.error("Erreur lors de la lecture du panier depuis localStorage",t),[]}}function i(t){try{localStorage.setItem("cart",JSON.stringify(t)),console.log("Panier sauvegardé:",t)}catch(t){console.error("Erreur lors de l'écriture du panier dans localStorage",t)}}function r(){const t=s().reduce((t,e)=>t+(e.quantity||0),0);a&&(t>0?(a.textContent=t,a.style.display="flex"):(a.textContent="0",a.style.display="flex"))}function u(){let n=0;if(!e||!o)return void console.error("Éléments de totaux non trouvés");t.querySelectorAll(".cart-item").forEach(t=>{const e=t.querySelector(".quantity-display"),o=t.querySelector(".item-total");if(e&&o){const c=(parseInt(e.textContent)||0)*(parseFloat(t.dataset.price)||0);o.textContent=`€${c.toFixed(2)}`,n+=c}}),e.textContent=`€${n.toFixed(2)}`,o.textContent=`€${(n+0).toFixed(2)}`,console.log("Totaux mis à jour - Sous-total:",n,"Total:",n+0)}function l(){const t=s();console.log("Vérification panier vide - Nombre d'articles:",t.length),c&&(c.style.display="block",console.log("Box récapitulatif affichée")),n?0===t.length?(n.style.display="block",console.log("Message panier vide affiché")):(n.style.display="none",console.log("Message panier vide masqué")):console.error("Élément .empty-cart-message non trouvé dans le DOM")}function m(){if(console.log("=== CHARGEMENT DU PANIER ==="),!t)return void console.error("Liste des articles du panier non trouvée (.cart-items-list)");const e=s();for(;t.firstChild;)t.removeChild(t.firstChild);if(0===e.length)return console.log("Panier vide, affichage du message"),l(),u(),void r();console.log(`Chargement de ${e.length} articles`),e.forEach((e,o)=>{if(e.id&&e.name&&void 0!==e.price&&e.quantity){const n=function(t){console.log("Création de l'élément pour:",t);const e=document.createElement("li");e.className="cart-item",e.dataset.id=t.id,e.dataset.price=t.price;const o=document.createElement("img");o.className="item-image",o.src=t.image||"/public/50euro.png",o.alt=t.name,e.appendChild(o);const n=document.createElement("div");n.className="item-details";const c=document.createElement("div");c.className="item-name",c.textContent=t.name;const a=document.createElement("div");a.className="item-price",a.textContent=`€${t.price.toFixed(2)}`;const s=document.createElement("div");s.className="quantity-control";const i=document.createElement("span");i.className="quantity-label",i.textContent="Quantité :";const r=document.createElement("div");r.className="quantity-buttons";const u=document.createElement("button");u.className="quantity-button quantity-decrease",t.quantity<=1&&(u.disabled=!0),u.textContent="-";const l=document.createElement("span");l.className="quantity-display",l.textContent=String(t.quantity);const m=document.createElement("button");m.className="quantity-button quantity-increase",m.textContent="+",r.appendChild(u),r.appendChild(l),r.appendChild(m),s.appendChild(i),s.appendChild(r),n.appendChild(c),n.appendChild(a),n.appendChild(s),e.appendChild(n);const d=document.createElement("div");d.className="item-actions";const p=document.createElement("div");p.className="item-total",p.textContent=`€${(t.price*t.quantity).toFixed(2)}`;const f=document.createElement("button");return f.className="remove-button",f.textContent="Supprimer",d.appendChild(p),d.appendChild(f),e.appendChild(d),e}(e);t.appendChild(n),console.log(`Article ${o+1} ajouté:`,e.name)}else console.warn(`Article ${o+1} incomplet ignoré:`,e)}),u(),l(),r(),console.log("=== FIN CHARGEMENT PANIER ===")}console.log("Éléments DOM trouvés:"),console.log("- cartItemsList:",t),console.log("- subtotalEl:",e),console.log("- totalEl:",o),console.log("- emptyCartMessage:",n),console.log("- cartSummarySection:",c),t&&t.addEventListener("click",e=>{const o=e.target;if(o.classList.contains("quantity-button")){const e=o.classList.contains("quantity-increase")||"+"===o.textContent.trim(),n=o.closest(".cart-item"),c=n.querySelector(".quantity-display"),a=n.querySelector(".quantity-decrease");if(!c)return;let s=parseInt(c.textContent)||1;if(!e&&s<=1)return;s=e?s+1:s-1,c.textContent=s,a&&(a.disabled=s<=1),u(),function(){const e=[];t.querySelectorAll(".cart-item").forEach(t=>{const o=t.querySelector(".quantity-display"),n=t.querySelector(".item-name"),c=t.querySelector(".item-image");o&&n&&c&&e.push({id:t.dataset.id,name:n.textContent,price:parseFloat(t.dataset.price),image:c.src,quantity:parseInt(o.textContent)||1})}),i(e)}(),r()}if(o.classList.contains("remove-button")){!function(t){console.log("=== SUPPRESSION ARTICLE ===");const e=t.dataset.id;console.log("ID à supprimer:",e);let o=s();console.log("Panier avant suppression:",o.length,"articles"),o=o.filter(t=>t.id.toString()!==e.toString()),console.log("Panier après suppression:",o.length,"articles"),i(o),t.remove(),u(),l(),r(),console.log("=== FIN SUPPRESSION ===")}(o.closest(".cart-item"))}}),console.log("Initialisation de la page panier..."),m(),window.cartUtils={clearCart:function(){confirm("Êtes-vous sûr de vouloir vider le panier ?")&&(i([]),m())},loadCart:m,readCart:s}});