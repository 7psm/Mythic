document.addEventListener("DOMContentLoaded",()=>{console.log("=== INITIALISATION PAGE PANIER ===");const t=document.querySelector(".cart-items-list"),e=document.querySelector(".summary-subtotal"),n=document.querySelector(".summary-total-value"),o=document.querySelector(".empty-cart-message"),i=document.querySelector(".cart-summary-section"),s=document.querySelector(".cart-count");function c(){try{const t=localStorage.getItem("cart");console.log("Données brutes du panier:",t);const e=JSON.parse(t||"[]");return console.log("Panier parsé:",e),e}catch(t){return console.error("Erreur lors de la lecture du panier depuis localStorage",t),[]}}function r(t){try{localStorage.setItem("cart",JSON.stringify(t)),console.log("Panier sauvegardé:",t)}catch(t){console.error("Erreur lors de l'écriture du panier dans localStorage",t)}}function l(){const t=c().reduce((t,e)=>t+(e.quantity||0),0);s&&(t>0?(s.textContent=t,s.style.display="flex"):(s.textContent="0",s.style.display="flex"))}function a(){let o=0;if(!e||!n)return void console.error("Éléments de totaux non trouvés");t.querySelectorAll(".cart-item").forEach(t=>{const e=t.querySelector(".quantity-display"),n=t.querySelector(".item-total");if(e&&n){const i=(parseInt(e.textContent)||0)*(parseFloat(t.dataset.price)||0);n.textContent=`€${i.toFixed(2)}`,o+=i}}),e.textContent=`€${o.toFixed(2)}`,n.textContent=`€${(o+0).toFixed(2)}`,console.log("Totaux mis à jour - Sous-total:",o,"Total:",o+0)}function u(){const t=c();console.log("Vérification panier vide - Nombre d'articles:",t.length),i&&(i.style.display="block",console.log("Box récapitulatif affichée")),o?0===t.length?(o.style.display="block",console.log("Message panier vide affiché")):(o.style.display="none",console.log("Message panier vide masqué")):console.error("Élément .empty-cart-message non trouvé dans le DOM")}function d(){if(console.log("=== CHARGEMENT DU PANIER ==="),!t)return void console.error("Liste des articles du panier non trouvée (.cart-items-list)");const e=c();for(;t.firstChild;)t.removeChild(t.firstChild);if(0===e.length)return console.log("Panier vide, affichage du message"),u(),a(),void l();console.log(`Chargement de ${e.length} articles`),e.forEach((e,n)=>{if(e.id&&e.name&&void 0!==e.price&&e.quantity){const o=function(t){console.log("Création de l'élément pour:",t);const e=document.createElement("li");e.className="cart-item",e.dataset.id=t.id,e.dataset.price=t.price;const n=document.createElement("div");n.className="item-image";let o="";const i=t.name.toLowerCase();o=i.includes("nitro")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="#5865F2" stroke="#7289DA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ':i.includes("boost")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2C12 2 6 6 6 12C6 15 7 18 7 18L12 22L17 18C17 18 18 15 18 12C18 6 12 2 12 2Z" fill="#F093FB" stroke="#F5576C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <circle cx="12" cy="12" r="2" fill="white"/>\n        </svg>\n      ':i.includes("avatar")||i.includes("décoration")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#43E97B" stroke="#38F9D7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ':i.includes("member")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <circle cx="9" cy="7" r="4" fill="#FA709A" stroke="#FEE140" stroke-width="1.5"/>\n          <circle cx="15" cy="9" r="3" fill="#FA709A" stroke="#FEE140" stroke-width="1.5"/>\n          <path d="M3 18C3 15 5 13 9 13C13 13 15 15 15 18" stroke="#FA709A" stroke-width="1.5" stroke-linecap="round"/>\n          <path d="M15 18C15 16 16 14 19 14C21 14 22 15 22 17" stroke="#FEE140" stroke-width="1.5" stroke-linecap="round"/>\n        </svg>\n      ':'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" fill="#5865F2" stroke="#7289DA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="7.5 4.21 12 6.81 16.5 4.21" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="7.5 19.79 7.5 14.6 3 12" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="21 12 16.5 14.6 16.5 19.79" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="3.27 6.96 12 12.01 20.73 6.96" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <line x1="12" y1="22.08" x2="12" y2="12" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ',n.innerHTML=o,e.appendChild(n);const s=document.createElement("div");s.className="item-details";const c=document.createElement("div");c.className="item-name",c.textContent=t.name;const r=document.createElement("div");r.className="item-price",r.textContent=`€${t.price.toFixed(2)}`;const l=document.createElement("div");l.className="quantity-control";const a=document.createElement("span");a.className="quantity-label",a.textContent="Quantité :";const u=document.createElement("div");u.className="quantity-buttons";const d=document.createElement("button");d.className="quantity-button quantity-decrease",t.quantity<=1&&(d.disabled=!0),d.textContent="-";const m=document.createElement("span");m.className="quantity-display",m.textContent=String(t.quantity);const p=document.createElement("button");p.className="quantity-button quantity-increase",p.textContent="+",u.appendChild(d),u.appendChild(m),u.appendChild(p),l.appendChild(a),l.appendChild(u),s.appendChild(c),s.appendChild(r),s.appendChild(l),e.appendChild(s);const h=document.createElement("div");h.className="item-actions";const v=document.createElement("div");v.className="item-total",v.textContent=`€${(t.price*t.quantity).toFixed(2)}`;const f=document.createElement("button");return f.className="remove-button",f.textContent="Supprimer",h.appendChild(v),h.appendChild(f),e.appendChild(h),e}(e);t.appendChild(o),console.log(`Article ${n+1} ajouté:`,e.name)}else console.warn(`Article ${n+1} incomplet ignoré:`,e)}),a(),u(),l(),console.log("=== FIN CHARGEMENT PANIER ===")}console.log("Éléments DOM trouvés:"),console.log("- cartItemsList:",t),console.log("- subtotalEl:",e),console.log("- totalEl:",n),t&&t.addEventListener("click",e=>{const n=e.target;if(n.classList.contains("quantity-button")){const e=n.classList.contains("quantity-increase")||"+"===n.textContent.trim(),o=n.closest(".cart-item"),i=o.querySelector(".quantity-display"),s=o.querySelector(".quantity-decrease");if(!i)return;let c=parseInt(i.textContent)||1;if(!e&&c<=1)return;c=e?c+1:c-1,i.textContent=c,s&&(s.disabled=c<=1),a(),function(){const e=[];t.querySelectorAll(".cart-item").forEach(t=>{const n=t.querySelector(".quantity-display"),o=t.querySelector(".item-name");n&&o&&e.push({id:t.dataset.id,name:o.textContent,price:parseFloat(t.dataset.price),image:"/public/logo.png",quantity:parseInt(n.textContent)||1})}),r(e)}(),l()}if(n.classList.contains("remove-button")){!function(t){console.log("=== SUPPRESSION ARTICLE ===");const e=t.dataset.id;console.log("ID à supprimer:",e);let n=c();console.log("Panier avant suppression:",n.length,"articles"),n=n.filter(t=>t.id.toString()!==e.toString()),console.log("Panier après suppression:",n.length,"articles"),r(n),t.remove(),a(),u(),l(),console.log("=== FIN SUPPRESSION ===")}(n.closest(".cart-item"))}}),console.log("Initialisation de la page panier..."),d(),window.cartUtils={clearCart:function(){confirm("Êtes-vous sûr de vouloir vider le panier ?")&&(r([]),d())},loadCart:d,readCart:c}});const t={PROMO15:{type:"percentage",value:15,description:"-15%"},PROMO25:{type:"percentage",value:25,description:"-25%"},WELCOME5:{type:"fixed",value:5,description:"-5€"}};let e=null;function n(){const t={subtotal:document.querySelector(".summary-subtotal"),tva:document.querySelector(".summary-tva"),total:document.querySelector(".summary-total-value"),discountedSection:document.querySelector(".summary-total-discounted"),originalPrice:document.querySelector(".summary-total-original"),newPrice:document.querySelector(".summary-total-new")};if(!t.subtotal)return;const n=(t.subtotal.textContent||t.subtotal.innerText).replace(/[€\s]/g,"").replace(",","."),o=parseFloat(n)||0,i=.2*o,s=o+i;if(t.tva&&(t.tva.textContent=`€${i.toFixed(2)}`),e){const n="percentage"===e.type?s*(e.value/100):e.value,o=Math.max(0,s-n);t.total?.classList.add("hidden"),t.discountedSection?.classList.remove("hidden"),t.originalPrice&&(t.originalPrice.textContent=`€${s.toFixed(2)}`),t.newPrice&&(t.newPrice.textContent=`€${o.toFixed(2)}`)}else t.total?.classList.remove("hidden"),t.discountedSection?.classList.add("hidden"),t.total&&(t.total.textContent=`€${s.toFixed(2)}`)}function o(t,e=!1){const n=document.getElementById("discount-message");n&&(n.textContent=t,n.className="mt-2 text-sm "+(e?"text-red-400":"text-green-400"),n.classList.remove("hidden"))}function i(){document.getElementById("discount-message")?.classList.add("hidden")}function s(){const s=document.getElementById("discount-code"),c=s.value.trim().toUpperCase();if(c)if(t[c]){e=t[c],function(){if(e){const n={code:Object.keys(t).find(n=>t[n]===e),type:e.type,value:e.value,description:e.description};localStorage.setItem("appliedDiscount",JSON.stringify(n))}else localStorage.removeItem("appliedDiscount")}();const o=document.getElementById("discount-info");o&&(o.textContent=`✓ Code "${c}" appliqué (${e.description})`),s.value="",s.disabled=!0,document.getElementById("apply-discount").disabled=!0,i(),n()}else o("❌ Code invalide",!0);else o("⚠️ Veuillez entrer un code",!0)}function c(){e=null,localStorage.removeItem("appliedDiscount");const t=document.getElementById("discount-code");t&&(t.disabled=!1,t.value="");const o=document.getElementById("apply-discount");o&&(o.disabled=!1),document.getElementById("discount-applied")?.classList.add("hidden"),i(),n()}document.addEventListener("DOMContentLoaded",function(){document.getElementById("apply-discount")?.addEventListener("click",s),document.getElementById("remove-discount")?.addEventListener("click",c),document.getElementById("discount-code")?.addEventListener("keypress",function(t){"Enter"===t.key&&(t.preventDefault(),s())});const t=document.querySelector(".summary-subtotal");if(t){new MutationObserver(n).observe(t,{childList:!0,characterData:!0,subtree:!0})}const e=document.querySelector(".cart-items-list");if(e){new MutationObserver(n).observe(e,{childList:!0,subtree:!0})}setTimeout(n,300)});