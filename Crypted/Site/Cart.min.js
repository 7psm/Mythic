document.addEventListener("DOMContentLoaded",()=>{console.log("=== INITIALISATION PAGE PANIER ===");const o=document.querySelector(".cart-items-list"),e=document.querySelector(".summary-subtotal"),t=document.querySelector(".summary-total-value"),n=document.querySelector(".empty-cart-message"),s=document.querySelector(".cart-summary-section"),i=document.querySelector(".cart-count");function c(){try{const o=localStorage.getItem("cart");console.log("Donn√©es brutes du panier:",o);const e=JSON.parse(o||"[]");return console.log("Panier pars√©:",e),e}catch(o){return console.error("Erreur lors de la lecture du panier depuis localStorage",o),[]}}function r(o){try{localStorage.setItem("cart",JSON.stringify(o)),console.log("Panier sauvegard√©:",o)}catch(o){console.error("Erreur lors de l'√©criture du panier dans localStorage",o)}}function u(){const o=c().reduce((o,e)=>o+(e.quantity||0),0);i&&(o>0?(i.textContent=o,i.style.display="flex"):(i.textContent="0",i.style.display="flex"))}function a(){let n=0;if(!e||!t)return void console.error("√âl√©ments de totaux non trouv√©s");o.querySelectorAll(".cart-item").forEach(o=>{const e=o.querySelector(".quantity-display"),t=o.querySelector(".item-total");if(e&&t){const s=(parseInt(e.textContent)||0)*(parseFloat(o.dataset.price)||0);t.textContent=`‚Ç¨${s.toFixed(2)}`,n+=s}}),e.textContent=`‚Ç¨${n.toFixed(2)}`,t.textContent=`‚Ç¨${(n+0).toFixed(2)}`,console.log("Totaux mis √† jour - Sous-total:",n,"Total:",n+0)}function l(){const o=c();console.log("V√©rification panier vide - Nombre d'articles:",o.length),s&&(s.style.display="block",console.log("Box r√©capitulatif affich√©e")),n?0===o.length?(n.style.display="block",console.log("Message panier vide affich√©")):(n.style.display="none",console.log("Message panier vide masqu√©")):console.error("√âl√©ment .empty-cart-message non trouv√© dans le DOM")}function d(){if(console.log("=== CHARGEMENT DU PANIER ==="),!o)return void console.error("Liste des articles du panier non trouv√©e (.cart-items-list)");const e=c();for(;o.firstChild;)o.removeChild(o.firstChild);if(0===e.length)return console.log("Panier vide, affichage du message"),l(),a(),void u();console.log(`Chargement de ${e.length} articles`),e.forEach((e,t)=>{if(e.id&&e.name&&void 0!==e.price&&e.quantity){const n=function(o){console.log("Cr√©ation de l'√©l√©ment pour:",o);const e=document.createElement("li");e.className="cart-item",e.dataset.id=o.id,e.dataset.price=o.price;const t=document.createElement("div");t.className="item-image";let n="";const s=o.name.toLowerCase();n=s.includes("nitro")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M13 2L3 14h8l-1 8 10-12h-8l1-8z" fill="#5865F2" stroke="#7289DA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ':s.includes("boost")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2C12 2 6 6 6 12C6 15 7 18 7 18L12 22L17 18C17 18 18 15 18 12C18 6 12 2 12 2Z" fill="#F093FB" stroke="#F5576C" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <circle cx="12" cy="12" r="2" fill="white"/>\n        </svg>\n      ':s.includes("avatar")||s.includes("d√©coration")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" fill="#43E97B" stroke="#38F9D7" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ':s.includes("member")?'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <circle cx="9" cy="7" r="4" fill="#FA709A" stroke="#FEE140" stroke-width="1.5"/>\n          <circle cx="15" cy="9" r="3" fill="#FA709A" stroke="#FEE140" stroke-width="1.5"/>\n          <path d="M3 18C3 15 5 13 9 13C13 13 15 15 15 18" stroke="#FA709A" stroke-width="1.5" stroke-linecap="round"/>\n          <path d="M15 18C15 16 16 14 19 14C21 14 22 15 22 17" stroke="#FEE140" stroke-width="1.5" stroke-linecap="round"/>\n        </svg>\n      ':'\n        <svg width="100%" height="100%" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" fill="#5865F2" stroke="#7289DA" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="7.5 4.21 12 6.81 16.5 4.21" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="7.5 19.79 7.5 14.6 3 12" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="21 12 16.5 14.6 16.5 19.79" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <polyline points="3.27 6.96 12 12.01 20.73 6.96" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n          <line x1="12" y1="22.08" x2="12" y2="12" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n      ',t.innerHTML=n,e.appendChild(t);const i=document.createElement("div");i.className="item-details";const c=document.createElement("div");c.className="item-name",c.textContent=o.name;const r=document.createElement("div");r.className="item-price",r.textContent=`‚Ç¨${o.price.toFixed(2)}`;const u=document.createElement("div");u.className="quantity-control";const a=document.createElement("span");a.className="quantity-label",a.textContent="Quantit√© :";const l=document.createElement("div");l.className="quantity-buttons";const d=document.createElement("button");d.className="quantity-button quantity-decrease",o.quantity<=1&&(d.disabled=!0),d.textContent="-";const p=document.createElement("span");p.className="quantity-display",p.textContent=String(o.quantity);const m=document.createElement("button");m.className="quantity-button quantity-increase",m.textContent="+",l.appendChild(d),l.appendChild(p),l.appendChild(m),u.appendChild(a),u.appendChild(l),i.appendChild(c),i.appendChild(r),i.appendChild(u),e.appendChild(i);const h=document.createElement("div");h.className="item-actions";const g=document.createElement("div");g.className="item-total",g.textContent=`‚Ç¨${(o.price*o.quantity).toFixed(2)}`;const v=document.createElement("button");return v.className="remove-button",v.textContent="Supprimer",h.appendChild(g),h.appendChild(v),e.appendChild(h),e}(e);o.appendChild(n),console.log(`Article ${t+1} ajout√©:`,e.name)}else console.warn(`Article ${t+1} incomplet ignor√©:`,e)}),a(),l(),u(),console.log("=== FIN CHARGEMENT PANIER ===")}console.log("√âl√©ments DOM trouv√©s:"),console.log("- cartItemsList:",o),console.log("- subtotalEl:",e),console.log("- totalEl:",t),o&&o.addEventListener("click",e=>{const t=e.target;if(t.classList.contains("quantity-button")){const e=t.classList.contains("quantity-increase")||"+"===t.textContent.trim(),n=t.closest(".cart-item"),s=n.querySelector(".quantity-display"),i=n.querySelector(".quantity-decrease");if(!s)return;let c=parseInt(s.textContent)||1;if(!e&&c<=1)return;c=e?c+1:c-1,s.textContent=c,i&&(i.disabled=c<=1),a(),function(){const e=[];o.querySelectorAll(".cart-item").forEach(o=>{const t=o.querySelector(".quantity-display"),n=o.querySelector(".item-name");t&&n&&e.push({id:o.dataset.id,name:n.textContent,price:parseFloat(o.dataset.price),image:"/public/logo.png",quantity:parseInt(t.textContent)||1})}),r(e)}(),u()}if(t.classList.contains("remove-button")){!function(o){console.log("=== SUPPRESSION ARTICLE ===");const e=o.dataset.id;console.log("ID √† supprimer:",e);let t=c();console.log("Panier avant suppression:",t.length,"articles"),t=t.filter(o=>o.id.toString()!==e.toString()),console.log("Panier apr√®s suppression:",t.length,"articles"),r(t),o.remove(),a(),l(),u(),console.log("=== FIN SUPPRESSION ===")}(t.closest(".cart-item"))}}),console.log("Initialisation de la page panier..."),d(),window.cartUtils={clearCart:function(){confirm("√ätes-vous s√ªr de vouloir vider le panier ?")&&(r([]),d())},loadCart:d,readCart:c}});let currentDiscount=null;function getDiscountCodes(){try{const o=localStorage.getItem("discountCodes");console.log("üì¶ Codes bruts r√©cup√©r√©s:",o);const e=o?JSON.parse(o):{};return console.log("‚úÖ Codes pars√©s:",e),e}catch(o){return console.error("‚ùå Erreur lecture codes promo:",o),{}}}function loadAppliedDiscount(){try{const o=localStorage.getItem("appliedDiscount");if(o){const e=JSON.parse(o);currentDiscount=e;const t=document.getElementById("discount-code"),n=document.getElementById("apply-discount"),s=document.getElementById("discount-applied"),i=document.getElementById("discount-info");t&&(t.disabled=!0),n&&(n.disabled=!0),s&&s.classList.remove("hidden"),i&&(i.textContent=`‚úì Code "${e.code}" appliqu√© (${e.description})`),updatePrices()}}catch(o){console.error("Erreur chargement code promo:",o)}}function updatePrices(){const o={subtotal:document.querySelector(".summary-subtotal"),tva:document.querySelector(".summary-tva"),total:document.querySelector(".summary-total-value"),discountedSection:document.querySelector(".summary-total-discounted"),originalPrice:document.querySelector(".summary-total-original"),newPrice:document.querySelector(".summary-total-new")};if(!o.subtotal)return;const e=(o.subtotal.textContent||o.subtotal.innerText).replace(/[‚Ç¨\s]/g,"").replace(",","."),t=parseFloat(e)||0,n=.2*t,s=t+n;if(o.tva&&(o.tva.textContent=`‚Ç¨${n.toFixed(2)}`),currentDiscount){const e="percentage"===currentDiscount.type?s*(currentDiscount.value/100):currentDiscount.value,t=Math.max(0,s-e);o.total&&o.total.classList.add("hidden"),o.discountedSection&&o.discountedSection.classList.remove("hidden"),o.originalPrice&&(o.originalPrice.textContent=`‚Ç¨${s.toFixed(2)}`),o.newPrice&&(o.newPrice.textContent=`‚Ç¨${t.toFixed(2)}`)}else o.total&&o.total.classList.remove("hidden"),o.discountedSection&&o.discountedSection.classList.add("hidden"),o.total&&(o.total.textContent=`‚Ç¨${s.toFixed(2)}`)}function showMessage(o,e=!1){const t=document.getElementById("discount-message");t&&(t.textContent=o,t.className="mt-2 text-sm "+(e?"text-red-400":"text-green-400"),t.classList.remove("hidden"))}function hideMessage(){document.getElementById("discount-message")?.classList.add("hidden")}function applyDiscount(){const o=document.getElementById("discount-code"),e=o.value.trim().toUpperCase();if(console.log("üîç Tentative d'application du code:",e),!e)return void showMessage("‚ö†Ô∏è Veuillez entrer un code",!0);const t=getDiscountCodes();if(console.log("üìã Codes disponibles:",t),console.log("üîë Cl√©s des codes:",Object.keys(t)),t[e]){console.log("‚úÖ Code trouv√©!",t[e]),currentDiscount={code:e,...t[e]},saveDiscountToStorage();const n=document.getElementById("discount-info"),s=document.getElementById("discount-applied");n&&(n.textContent=`‚úì Code "${e}" appliqu√© (${currentDiscount.description})`),s&&s.classList.remove("hidden"),o.value="",o.disabled=!0,document.getElementById("apply-discount").disabled=!0,hideMessage(),updatePrices(),console.log("‚úÖ Code promo appliqu√©:",e),showMessage(`‚úì Code "${e}" appliqu√© avec succ√®s!`,!1)}else console.log("‚ùå Code invalide:",e),console.log("Comparaison:"),Object.keys(t).forEach(o=>{console.log(`  - "${o}" === "${e}":`,o===e)}),showMessage("‚ùå Code invalide",!0)}function removeDiscount(){currentDiscount=null,localStorage.removeItem("appliedDiscount");const o=document.getElementById("discount-code");o&&(o.disabled=!1,o.value="");const e=document.getElementById("apply-discount");e&&(e.disabled=!1);const t=document.getElementById("discount-applied");t&&t.classList.add("hidden"),hideMessage(),updatePrices(),console.log("üóëÔ∏è Code promo retir√©")}function saveDiscountToStorage(){currentDiscount?localStorage.setItem("appliedDiscount",JSON.stringify(currentDiscount)):localStorage.removeItem("appliedDiscount")}document.addEventListener("DOMContentLoaded",function(){console.log("üé¨ Initialisation syst√®me de codes promo");const o=getDiscountCodes();console.log("üì¶ Codes charg√©s au d√©marrage:",o),window.addEventListener("storage",function(o){if(console.log("üîî Changement d√©tect√© dans localStorage:",o.key),"discountCodes"===o.key){console.log("‚ú® Codes promo mis √† jour depuis un autre onglet!"),console.log("Ancienne valeur:",o.oldValue),console.log("Nouvelle valeur:",o.newValue);const e=getDiscountCodes();console.log("üì¶ Codes recharg√©s:",e);const t=o.oldValue?JSON.parse(o.oldValue):{},n=o.newValue?JSON.parse(o.newValue):{},s=Object.keys(n).filter(o=>!t[o]);s.length>0&&(showMessage(`‚ú® Nouveau code disponible : ${s.join(", ")}`,!1),setTimeout(hideMessage,5e3))}"appliedDiscount"===o.key&&(console.log("üéüÔ∏è Code appliqu√© mis √† jour depuis un autre onglet!"),loadAppliedDiscount())}),loadAppliedDiscount(),document.getElementById("apply-discount")?.addEventListener("click",applyDiscount),document.getElementById("remove-discount")?.addEventListener("click",removeDiscount),document.getElementById("discount-code")?.addEventListener("keypress",function(o){"Enter"===o.key&&(o.preventDefault(),applyDiscount())});const e=document.querySelector(".summary-subtotal");if(e){new MutationObserver(updatePrices).observe(e,{childList:!0,characterData:!0,subtree:!0})}const t=document.querySelector(".cart-items-list");if(t){new MutationObserver(updatePrices).observe(t,{childList:!0,subtree:!0})}setTimeout(updatePrices,300)});