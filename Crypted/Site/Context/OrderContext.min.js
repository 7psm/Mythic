const t="cart",n=[{id:1,name:"Livraison Express",price:10,delivery:"1 - 3 DAYS"},{id:2,name:"Livraison Classique",price:0,delivery:"3 - 6 DAYS"}],e={PROMO15:{type:"percentage",value:15,description:"-15%"},PROMO25:{type:"percentage",value:25,description:"-25%"},WELCOME5:{type:"fixed",value:5,description:"-5€"}};function o(){try{const n=localStorage.getItem(t);return JSON.parse(n||"[]")}catch(t){return console.error("❌ Erreur lecture panier:",t),[]}}function r(n){try{localStorage.setItem(t,JSON.stringify(n)),i()}catch(t){console.error("❌ Erreur sauvegarde panier:",t)}}function a(){return o().reduce((t,n)=>t+(n.quantity||0),0)}function c(){return o().reduce((t,n)=>t+n.price*n.quantity,0)}function i(){const t=document.querySelectorAll(".cart-count"),n=a();t.forEach(t=>{t&&(t.textContent=n,t.style.display=n>0?"flex":"none")})}function u(){try{const t=localStorage.getItem("appliedDiscount");return t?JSON.parse(t):null}catch{return null}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i(),window.addEventListener("storage",n=>{n.key===t&&i()}),window.MythicMarket={t:e,getCart:o,addToCart:function(t,n=null){const e=o(),a={id:Date.now().toString(),name:n?.name||t.name,price:n?.price||t.price,quantity:1,image:t.image||defaultImages[t.category]||"/public/logo.png",category:t.category},c=e.findIndex(t=>t.name===a.name&&Math.abs(t.price-a.price)<.01);return-1!==c?e[c].quantity+=1:e.push(a),r(e),console.log("✅ Produit ajouté:",a.name),e},removeFromCart:function(t){const n=o().filter(n=>n.id!==t);return r(n),n},updateQuantity:function(t,n){if(n<1)return o();const e=o().map(e=>e.id===t?{...e,quantity:n}:e);return r(e),e},clearCart:function(){localStorage.removeItem(t),i()},getCartCount:a,updateCartCount:i,calculateSubtotal:c,calculateTotal:function(t=n[1]){return c()+t.price},calculateFinalTotal:function(t){const n=u();if(!n)return{original:t,final:t,discount:null,saved:0};const e="percentage"===n.type?t*(n.value/100):n.value;return{original:t,final:Math.max(0,t-e),discount:n,saved:e}},applyDiscountCode:function(t){const n=t.trim().toUpperCase(),o=e[n];return o?(localStorage.setItem("appliedDiscount",JSON.stringify({code:n,...o})),o):null},getActiveDiscount:u,removeDiscount:function(){localStorage.removeItem("appliedDiscount")},generateOrderNumber:function(){return`MM-${(new Date).getTime().toString().slice(-6)}-${Math.floor(1e4*Math.random()).toString().padStart(4,"0")}`}},console.log("✅ MythicMarket OrderContext initialisé");