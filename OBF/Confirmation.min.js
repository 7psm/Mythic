document.addEventListener("DOMContentLoaded",function(){let t=!1,e=!1,n=".uwg9",o={};const i={submitButton:document.getElementById("submit-order"),screenshotModal:document.getElementById("screenshot-modal"),vendorModal:document.getElementById("vendor-modal"),thankYouModal:document.getElementById("confirmation-modal"),screenshotTakenBtn:document.getElementById("screenshot-taken-btn"),continueToVendorBtn:document.getElementById("continue-to-vendor"),confirmationOkBtn:document.getElementById("confirmation-ok-btn")};function c(t){const e=(t||"").toLowerCase();return e.includes("express")?"2-4H":(e.includes("standard")||e.includes("classique"),"6-12h")}function d(){return`PM-${Math.floor(1e5+9e5*Math.random())}-${Math.floor(1e3+9e3*Math.random())}`}function a(){p(),window.location.href="/index.html"}function s(){t?m():u(i.screenshotModal)}function r(){t=!0,h(i.screenshotModal),m()}function m(){setTimeout(()=>{u(i.vendorModal);const t=document.querySelector('.vendor-option[data-vendor="MolarMarket"]');if(t){t.classList.add("selected");const e=t.querySelector(".radio-indicator");e&&e.classList.add("checked")}},3e3)}function l(){n="MolarMarket",h(i.vendorModal),async function(){if(e)return;e=!0;try{const t=await fetch("http://localhost:3001/api/order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,selectedVendor:n})});await t.json()}catch(t){}finally{e=!1,p()}}(),window.open("https://discord.gg/beC8cFZaXH","_blank"),u(i.thankYouModal)}function p(){localStorage.removeItem("cart"),localStorage.removeItem("checkoutData"),localStorage.removeItem("secureCheckoutData"),sessionStorage.removeItem("checkoutData")}function u(t){t&&(t.style.display="flex")}function h(t){t&&(t.style.display="none")}!function(){if(window.history.replaceState){const t=window.location.pathname;window.history.replaceState({},document.title,t)}}(),function(){const t=localStorage.getItem("secureCheckoutData");let e=t?function(t){try{const e=decodeURIComponent(atob(t)).replace("checkout_secure_key_2024","");return JSON.parse(e)}catch{return null}}(t):null;const n=JSON.parse(localStorage.getItem("cart")||"[]"),i=localStorage.getItem("selectedShippingMethod")||"Livraison Standard",a=localStorage.getItem("selectedPaymentMethod")||"PayPal";o={orderNumber:d(),orderDate:(new Date).toISOString(),name:e?.customerInfo?.name||"Client",email:e?.customerInfo?.email||"Non renseigné",phoneNumber:e?.customerInfo?.phone||"Non renseigné",discord:e?.customerInfo?.discord||"Non renseigné",address:e?.shippingInfo?.address||"Non renseigné",city:e?.shippingInfo?.city||"Non renseigné",country:e?.shippingInfo?.country||"Non renseigné",postalCode:e?.shippingInfo?.postalCode||"Non renseigné",orderItems:n,shippingMethod:{name:i,price:i.includes("Express")?2.5:0,delivery:c(i)},paymentMethod:a}}(),function(){const t={orderNumber:document.getElementById("order-number"),orderDate:document.getElementById("order-date"),customerName:document.getElementById("customer-name"),contactName:document.getElementById("contact-name"),contactEmail:document.getElementById("contact-email"),contactPhone:document.getElementById("contact-phone"),contactDiscord:document.getElementById("contact-discord"),shippingAddress:document.getElementById("shipping-address"),shippingCity:document.getElementById("shipping-city"),shippingCountry:document.getElementById("shipping-country"),shippingPostal:document.getElementById("shipping-postal"),shippingMethod:document.getElementById("shipping-method"),shippingDelivery:document.getElementById("shipping-delivery"),paymentMethod:document.getElementById("payment-method")};t.orderNumber&&(t.orderNumber.textContent=o.orderNumber),t.orderDate&&(t.orderDate.textContent=new Date(o.orderDate).toLocaleDateString("fr-FR")),t.customerName&&(t.customerName.textContent=o.name),t.contactName&&(t.contactName.textContent=o.name),t.contactEmail&&(t.contactEmail.textContent=o.email),t.contactPhone&&(t.contactPhone.textContent=o.phoneNumber),t.contactDiscord&&(t.contactDiscord.textContent=o.discord),t.shippingAddress&&(t.shippingAddress.textContent=o.address),t.shippingCity&&(t.shippingCity.textContent=o.city),t.shippingCountry&&(t.shippingCountry.textContent=o.country),t.shippingPostal&&(t.shippingPostal.textContent=o.postalCode),t.shippingMethod&&(t.shippingMethod.textContent=o.shippingMethod.name),t.shippingDelivery&&(t.shippingDelivery.textContent=o.shippingMethod.delivery),t.paymentMethod&&(t.paymentMethod.textContent=o.paymentMethod),function(){const t=document.getElementById("order-items");t&&(t.innerHTML="",o.orderItems.forEach(e=>{const n=document.createElement("div");n.className="order-item";const o=document.createElement("span");o.className="item-name",o.textContent=e.name;const i=document.createElement("span");i.textContent=`x${e.quantity||1}`,o.appendChild(i);const c=document.createElement("span");c.className="item-price",c.textContent=`€${e.price.toFixed(2)}`,n.appendChild(o),n.appendChild(c),t.appendChild(n)}))}(),function(){const t=o.orderItems.reduce((t,e)=>t+e.price*e.quantity,0),e=o.shippingMethod.price,n=t+e,i={subtotal:document.getElementById("subtotal"),shippingCost:document.getElementById("shipping-cost"),totalCost:document.getElementById("total-cost")};i.subtotal&&(i.subtotal.textContent=`€${t.toFixed(2)}`),i.shippingCost&&(i.shippingCost.textContent=e>0?`€${e.toFixed(2)}`:"Gratuit"),i.totalCost&&(i.totalCost.textContent=`€${n.toFixed(2)}`)}()}(),i.submitButton&&i.submitButton.addEventListener("click",s),i.screenshotTakenBtn&&i.screenshotTakenBtn.addEventListener("click",r),i.continueToVendorBtn&&i.continueToVendorBtn.addEventListener("click",l),i.confirmationOkBtn&&i.confirmationOkBtn.addEventListener("click",a),i.submitButton&&(i.submitButton.disabled=!1)});