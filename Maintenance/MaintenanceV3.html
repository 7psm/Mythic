<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Status | Incognito Market</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: "Segoe UI", Roboto, Arial, sans-serif;
      background: #0f0f0f;
      color: #f1f1f1;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      flex-direction: column;
    }

    .status-container {
      max-width: 700px;
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #333;
      border-radius: 14px;
      padding: 24px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
      animation: fadeIn 0.4s ease-in-out;
    }

    .status-tag {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 14px;
    }

    .tag-online { background: rgba(67, 184, 97, 0.2); color: #43b861; }
    .tag-maintenance { background: rgba(254, 231, 92, 0.15); color: #fee75c; }
    .tag-offline { background: rgba(237, 66, 69, 0.2); color: #ed4245; }
    .tag-critical { background: rgba(240, 71, 71, 0.25); color: #f04747; }

    h1 {
      font-size: 1.5rem;
      margin-bottom: 6px;
      text-align: center;
    }

    .time-range {
      font-size: 0.9rem;
      color: #aaa;
      margin-bottom: 20px;
      text-align: center;
    }

    .details {
      background: #121212;
      padding: 18px;
      border-radius: 10px;
      border: 1px solid #2a2a2a;
      margin-bottom: 16px;
    }

    .details p {
      font-size: 0.95rem;
      line-height: 1.6;
      margin-bottom: 8px;
      color: #ddd;
      text-align: center;
    }

    .details strong { color: #fff; }

    .status-footer {
      font-size: 0.8rem;
      color: #666;
      text-align: center;
      margin-top: 20px;
    }

    .admin-panel {
      max-width: 700px;
      width: 100%;
      background: #1a1a1a;
      border: 1px solid #444;
      border-radius: 14px;
      padding: 24px;
      margin-bottom: 20px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    }

    .admin-title {
      color: #f39c12;
      font-size: 1.2rem;
      margin-bottom: 16px;
      text-align: center;
    }

    .buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      background: #222;
      border: 1px solid #444;
      padding: 8px 14px;
      border-radius: 8px;
      color: #eee;
      cursor: pointer;
      transition: all 0.2s ease;
      font-size: 0.9rem;
    }

    button:hover {
      background: #333;
      border-color: #666;
    }

    .loading {
      text-align: center;
      color: #aaa;
      font-style: italic;
    }

    .error {
      background: rgba(237, 66, 69, 0.1);
      border: 1px solid #ed4245;
      color: #ed4245;
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 16px;
    }

    .auto-refresh {
      font-size: 0.8rem;
      color: #888;
      text-align: center;
      margin-top: 10px;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 600px) {
      .buttons {
        flex-direction: column;
        align-items: center;
      }
      
      button {
        width: 200px;
      }
    }
  </style>
</head>
<body>

  <!-- Panel Admin (visible seulement pour l'admin) -->
  <div id="adminPanel" class="admin-panel" style="display: none;">
    <div class="admin-title">üîß Panel Administrateur</div>
    <div class="buttons">
      <button onclick="updateStatus('online')">üü¢ Online</button>
      <button onclick="updateStatus('maintenance')">üõ† Maintenance</button>
      <button onclick="updateStatus('offline')">üî¥ Offline</button>
      <button onclick="updateStatus('critical')">‚ö†Ô∏è Critical</button>
    </div>
    <div id="adminMessage" style="text-align: center; color: #aaa; font-size: 0.9rem;"></div>
  </div>

  <!-- Status Box (visible pour tous) -->
  <div id="statusBox" class="status-container">
    <div class="loading">Chargement du statut...</div>
  </div>

  <div class="auto-refresh">Actualisation automatique toutes les 30 secondes</div>

  <script>
    const statuses = {
      online: {
        tag: "üü¢ En ligne",
        tagClass: "tag-online",
        title: "Syst√®me pleinement op√©rationnel",
        details: [
          "<strong>‚úî Tous les services</strong> sont accessibles sans restriction.",
          "Merci pour votre patience pendant la derni√®re intervention."
        ]
      },
      maintenance: {
        tag: "üõ† Maintenance",
        tagClass: "tag-maintenance",
        title: "Maintenance planifi√©e en cours",
        details: [
          "Certains services peuvent √™tre temporairement <strong>inaccessibles</strong>.",
          "Notre √©quipe effectue des mises √† jour pour am√©liorer la s√©curit√© et la stabilit√©.",
          "Merci de votre compr√©hension üôè"
        ]
      },
      offline: {
        tag: "üî¥ Hors ligne",
        tagClass: "tag-offline",
        title: "Service momentan√©ment indisponible",
        details: [
          "Un probl√®me technique emp√™che actuellement l'acc√®s aux services.",
          "Notre √©quipe est d√©j√† mobilis√©e pour r√©tablir la situation.",
          "<strong>Nous publierons un patch d√®s que possible.</strong>"
        ]
      },
      critical: {
        tag: "‚ö†Ô∏è Probl√®me critique",
        tagClass: "tag-critical",
        title: "Incident majeur en cours",
        details: [
          "Nous rencontrons actuellement un <strong>incident critique</strong> affectant plusieurs services.",
          "Les performances et l'acc√®s sont fortement d√©grad√©s.",
          "Notre √©quipe traite le probl√®me en priorit√© absolue.",
          "Merci de rester inform√© via cette page pour les prochaines mises √† jour."
        ]
      }
    };

    let isAdmin = false;

    // V√©rifier si c'est l'admin (tu peux changer cette logique)
    function checkAdmin() {
      const adminKey = prompt("Cl√© administrateur :");
      if (adminKey === "admin123") { // Change cette cl√© !
        isAdmin = true;
        document.getElementById("adminPanel").style.display = "block";
        document.getElementById("adminMessage").textContent = "Connect√© en tant qu'administrateur";
      }
    }

    // Fermer le panel admin
    function closeAdminPanel() {
      document.getElementById("adminPanel").style.display = "none";
      document.getElementById("adminMessage").textContent = "";
      isAdmin = false; // Reset admin status
      adminKey = ''; // Reset admin key
      
      // Mettre √† jour le statut affich√© imm√©diatement
      loadStatus();
      
      // Afficher un message de confirmation temporaire
      const statusBox = document.getElementById("statusBox");
      const currentContent = statusBox.innerHTML;
      
      // Ajouter un message de confirmation en haut
      const confirmationMessage = `
        <div style="background: rgba(67, 184, 97, 0.2); border: 1px solid #43b861; color: #43b861; padding: 12px; border-radius: 8px; margin-bottom: 16px; text-align: center;">
          ‚úÖ Panel admin ferm√© - Statut mis √† jour
        </div>
        ${currentContent}
      `;
      
      statusBox.innerHTML = confirmationMessage;
      
      // Faire dispara√Ætre le message apr√®s 3 secondes
      setTimeout(() => {
        loadStatus(); // Recharger le statut final
      }, 3000);
    }

    // Charger le status depuis le JSON
    async function loadStatus() {
      try {
        const response = await fetch('/status.json');
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}`);
        }
        const data = await response.json();
        displayStatus(data.status, data.timestamp);
      } catch (error) {
        console.error('Erreur lors du chargement du status:', error);
        displayError("Impossible de charger le statut du service");
      }
    }

    // Afficher le status
    function displayStatus(statusType, timestamp) {
      const status = statuses[statusType];
      if (!status) {
        displayError("Status inconnu");
        return;
      }

      const box = document.getElementById("statusBox");
      const timeStr = timestamp ? new Date(timestamp).toLocaleString('fr-FR') : new Date().toLocaleString('fr-FR');

      box.innerHTML = `
        <div class="status-tag ${status.tagClass}">${status.tag}</div>
        <h1>${status.title}</h1>
        <p class="time-range">Derni√®re mise √† jour : ${timeStr}</p>
        <div class="details">
          ${status.details.map(d => `<p>${d}</p>`).join("")}
        </div>
        <div class="status-footer">
          Propuls√© par Mythic Status ‚Ä¢ Evann
        </div>
      `;
    }

    // Afficher une erreur
    function displayError(message) {
      const box = document.getElementById("statusBox");
      box.innerHTML = `
        <div class="error">${message}</div>
        <div class="status-footer">
          Propuls√© par Mythic Status ‚Ä¢ Evann
        </div>
      `;
    }

    // Mettre √† jour le status (admin seulement)
    async function updateStatus(statusType) {
      if (!isAdmin) return;

      try {
        const response = await fetch('/update-status', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            status: statusType,
            timestamp: new Date().toISOString()
          })
        });

        if (response.ok) {
          document.getElementById("adminMessage").textContent = `Status mis √† jour : ${statusType}`;
          loadStatus(); // Recharger imm√©diatement
        } else {
          document.getElementById("adminMessage").textContent = "Erreur lors de la mise √† jour";
        }
      } catch (error) {
        console.error('Erreur:', error);
        document.getElementById("adminMessage").textContent = "Erreur de connexion";
      }
    }

    // Auto-refresh toutes les 30 secondes
    setInterval(loadStatus, 30000);

    // Charger au d√©marrage
    window.onload = function() {
      loadStatus();
      
      // V√©rifier si admin au clic sur le logo ou avec un raccourci clavier
      document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.shiftKey && e.key === 'A') {
          e.preventDefault();
          checkAdmin();
        }
      });
    };
  </script>

</body>
</html>